WITH base AS (
    SELECT
        PULocationID,
        total_amount,
        fare_amount,
        tip_amount,
        tolls_amount,
        congestion_surcharge,
        trip_distance
    FROM {table}
    WHERE PULocationID IS NOT NULL
      AND trip_distance > 3
      AND payment_type != 5
)
SELECT
    PULocationID,
    COUNT(*) AS trips,
    SUM(total_amount) AS revenue,
    SUM(fare_amount) AS base_fare_total,
    SUM(tip_amount) AS tips_total,
    SUM(tolls_amount) AS tolls_total,
    SUM(congestion_surcharge) AS congestion_fees_total,
    AVG(total_amount) AS avg_total_per_trip
FROM base
GROUP BY PULocationID